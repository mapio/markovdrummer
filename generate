#!/usr/bin/env python

from sys import argv

import midi

from markovdrummer import filebaseext
from markovdrummer.markov import generate, load
from markovdrummer.midi import beats2track

if __name__ == '__main__':

	filename, basename, _ = filebaseext( argv[ 1 ] )
	num_beats = int( argv[ 2 ] )
	tick_per_quantum = int( argv[ 3 ] )
	resolution = int( argv[ 4 ] )

	model = load( filename )
	beats = generate( model, num_beats )
	track = beats2track( beats, tick_per_quantum )

	midi.write_midifile(
		'{}.b{}-t{}-r{}.mid'.format( basename, num_beats, tick_per_quantum, resolution ),
		midi.Pattern( format = 0, resolution = resolution, tracks = [ track ] )
	)
